var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,i=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&s(e,a,t[a]);if(r)for(var a of r(t))n.call(t,a)&&s(e,a,t[a]);return e},d=(e,r)=>t(e,a(r));import{P as o,u as c}from"./role.f4316dde.js";import{M as u,P as m,a as p}from"./Table.890ed4f1.js";import{r as h,j as v,c as y,l as g,aH as f,A as w,T as b,aS as x,m as I,aT as S,P as k,aF as C,aU as E,aV as N,D as _,M as j,aW as R,aX as T,aY as D,ay as O,C as P,aZ as z,a_ as A,a$ as q,B as F}from"./vendor.0941f634.js";import{s as L,P as M,a as V,b as K}from"./user.251d394e.js";import{r as G}from"./index.3ed70d1a.js";import{t as H}from"./throttle.a944a37a.js";import{u as W,c as X,g as $,a as B,d as U,b as Y,P as Z}from"./index.e491f0c7.js";import"./map.5b6c362c.js";const{Sider:J,Content:Q}=g,ee=({children:e,assideRender:t,assideWidth:a=280,onSeparatorDrag:r})=>{let l;const n=H((e=>{requestAnimationFrame((()=>{const t=a+e.clientX-l;null==r||r(Math.max(t,10))}))}),20),s=h.exports.useCallback((()=>{document.documentElement.style.userSelect="unset",document.documentElement.removeEventListener("mousemove",n),document.documentElement.removeEventListener("mouseup",s)}),[n]);return v(f,{style:{margin:"20px"},bordered:!1,children:y(g,{children:[t?y(J,{width:a,theme:"light",style:{paddingRight:"20px"},children:[t,y("div",{className:"separator",onMouseDown:e=>{l=e.clientX,document.documentElement.style.userSelect="none",document.documentElement.addEventListener("mousemove",n),document.documentElement.addEventListener("mouseup",s)},children:[v("i",{}),v("i",{})]})]}):null,v(g,{children:v(Q,{children:e})})]})})},te=[{title:"头像",width:80,dataIndex:"headImg",render:(e,t)=>v(w,{src:t.headImg})},{title:"姓名",width:120,dataIndex:"name",align:"center"},{title:"用户名",width:120,align:"center",dataIndex:"username"},{title:"所在部门",dataIndex:"departmentName",align:"center",width:180},{title:"所属角色",dataIndex:"roleNames",align:"center",width:220,render:(e,t)=>v(x,{children:t.roleNames.map((e=>v(b,{color:"success",children:e},e)))})},{title:"呢称",width:120,align:"center",dataIndex:"nickName"},{title:"邮箱",width:120,align:"center",dataIndex:"email"},{title:"手机",width:120,align:"center",dataIndex:"phone"},{title:"备注",width:120,align:"center",dataIndex:"remark"},{title:"状态",dataIndex:"status",width:100,render:(e,t)=>{const a=1===t.status;return v(b,{color:a?"success":"red",children:a?"启用":"禁用"})}}];var ae="_dept-tree-panel-container_iyz7m_1",re="_header_iyz7m_1",le="_title_iyz7m_5",ne="_operate-wrapper_iyz7m_9",se="_tool-item_iyz7m_12";const ie=e=>{const{currentDept:t,deptTree:a,onCancel:r,onSuccess:l,visible:n}=e,s=h.exports.useRef();return h.exports.useEffect((()=>{n&&(async()=>{var e,a;if((null==t?void 0:t.key)&&Number.isInteger(t.key)){const{department:r}=await $({departmentId:t.key});null==(a=s.current)||a.setFieldsValue({parentId:null!=(e=r.parentId)?e:-1,name:r.name,orderNum:r.orderNum})}})()}),[t,n]),y(u,{formRef:s,title:((null==t?void 0:t.key)?"编辑":"新增")+"部门",visible:n,modalProps:{onCancel:r},onFinish:async e=>{var a;if((null==t?void 0:t.key)&&Number.isInteger(t.key)){const a=d(i({},e),{id:null==t?void 0:t.key});await W(a);I.success("修改部门成功")}else{await X(e);I.success("新增部门成功")}return null==(a=s.current)||a.resetFields(),l(),!0},children:[v(o,{name:"name",label:"部门名称",placeholder:"请输入部门名称",rules:[{required:!0,message:"请输入部门名称!"}]}),v(k.Item,{name:"parentId",label:"上级部门",rules:[{required:!0,message:"请选择上级部门!"}],children:v(S,{style:{width:"100%"},dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:[{key:-1,title:"#",children:a}],placeholder:"请选择所属部门",treeDefaultExpandAll:!0})}),v(M,{label:"排序",name:"orderNum",min:0})]})},de=(e,t=null)=>e.filter((e=>e.parentId===t)).map((t=>({title:t.name,key:t.id,value:t.id,children:de(e,t.id)}))),oe=(e,t=[])=>e.reduce(((e,t)=>{const a=[t.key];return t.children&&a.push(...oe(t.children)),e.concat(a)}),t),ce=e=>{const[t,a]=h.exports.useState(!1),[r,l]=h.exports.useState([]),[n,s]=h.exports.useState([]),[i,d]=h.exports.useState(),[o,u]=c((async()=>{var t;const a=await B(),r=de(a),n=r.map((e=>e.key)),i=null==(t=a.find((e=>Object.is(e.parentId,null))))?void 0:t.id;return setTimeout((()=>{var t;s(i?[i]:[]),l(n),null==(t=e.onDeptTreeChange)||t.call(e,r)})),r}),[]);h.exports.useEffect((()=>{u()}),[u]);const m=()=>{d(void 0),a(!1)};return y(O,{children:[y("div",{className:ae,children:[y("div",{className:re,children:[v("div",{className:le,children:"组织架构"}),y("div",{className:ne,children:[v("div",{className:se,children:v(C,{title:"新增部门",children:v(E,{onClick:()=>{a(!0),d(void 0)}})})}),v("div",{className:se,children:v(C,{title:"点击刷新",children:v(N,{onClick:u,spin:o.loading})})})]})]}),v(D,{className:"draggable-tree",selectedKeys:n,expandedKeys:r,blockNode:!0,treeData:o.value,onSelect:(t,a)=>{var r;s(t),null==(r=e.onSelect)||r.call(e,oe(a.selectedNodes))},onExpand:e=>{l(e)},titleRender:e=>v(_,{overlay:y(j,{onClick:({domEvent:e})=>e.stopPropagation(),children:[v(j.Item,{children:y(x,{size:"large",align:"center",onClick:()=>{d(e),a(!0)},children:[v("span",{children:"编辑"}),v(R,{style:{verticalAlign:"0"}})]})},"1"),v(j.Item,{onClick:()=>{return t=e.key,void P.confirm({title:"您确定要删除该部门吗?",icon:v(z,{}),centered:!0,onOk:async()=>(await U({departmentId:t}),u())});var t},children:y(x,{size:"large",align:"center",children:[v("span",{children:"删除"}),v(T,{style:{verticalAlign:"0"}})]})},"2")]}),trigger:["contextMenu"],children:v("div",{children:e.title})})})]}),v(ie,{visible:t,deptTree:o.value,onSuccess:()=>{m(),u()},onCancel:m,currentDept:i})]})},ue=e=>{const{visible:t,deptTree:a,detail:r,onCancel:l,onSuccess:n}=e,s=h.exports.useRef();return h.exports.useEffect((()=>{var e,a;t&&(async()=>{var e,t;if(null==r?void 0:r.id){const{roles:a}=await(t={userId:r.id},G({url:L.info,method:"get",params:t}));null==(e=s.current)||e.setFieldsValue({roles:a})}})(),null==(e=s.current)||e.resetFields(),null==(a=s.current)||a.setFieldsValue(i({},r))}),[r,t]),y(u,{formRef:s,title:((null==r?void 0:r.id)?"编辑":"新增")+"用户",width:840,visible:t,layout:"horizontal",modalProps:{onCancel:l},onFinish:async e=>{if(null==r?void 0:r.id){const t=d(i({},e),{id:r.id});await function(e){return G({url:L.update,method:"post",data:e},{successMsg:"修改用户成功"})}(t);I.success("修改用户成功")}else{await function(e){return G({url:L.add,method:"post",data:e},{successMsg:"创建用户成功"})}(e);I.success("新增用户成功")}return n(),!0},children:[v(k.Item,{name:"departmentId",label:"所属部门",rules:[{required:!0,message:"请选择所属部门!"}],children:v(S,{style:{width:"100%"},dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:a,placeholder:"请选择所属部门",treeDefaultExpandAll:!0})}),v(V,{mode:"multiple",name:"roles",label:"所属角色",rules:[{required:!0,message:"请选择所属角色!"}],request:async()=>(await Y()).map((e=>({label:e.name,value:e.id})))}),v(o,{name:"username",label:"用户名",tooltip:"由6位以上的数字和字母组成",placeholder:"请输入用户名",rules:[{required:!0,message:"请输入用户名!"}]}),y(m.Group,{children:[v(o,{width:"md",name:"name",label:"姓名",placeholder:"请输入姓名",rules:[{required:!0,message:"请输入姓名!"}]}),v(o,{width:"md",name:"nickName",label:"昵称",placeholder:"请输入昵称"})]}),y(m.Group,{children:[v(o,{width:"md",name:"email",label:"邮箱",placeholder:"请输入邮箱"}),v(o,{width:"md",name:"phone",label:"手机",placeholder:"请输入手机"})]}),v(Z,{name:"remark",label:"备注"}),v(K.Group,{name:"status",label:"状态",initialValue:(null==r?void 0:r.status)||1,options:[{label:"启用",value:1},{label:"禁用",value:0}]})]})},me=()=>{const[e,t]=h.exports.useState(),[a,r]=h.exports.useState(!1),[l,n]=h.exports.useState(!1),[s,i]=h.exports.useState(260),[d,c]=h.exports.useState([]),[m,g]=h.exports.useState(),f=h.exports.useRef(),w=()=>{var e;return null==(e=null==f?void 0:f.current)?void 0:e.reload()},b=e=>{const t=Array.isArray(e)?e.map((e=>e.id)):[e.id];var a;(a={userIds:t},G({url:L.delete,method:"post",data:a})).finally(w)},S=()=>{n(!1),t(void 0)},k=[...te,{title:"操作",width:200,key:"option",valueType:"option",align:"center",fixed:"right",render:(e,a)=>[v("a",{onClick:()=>{t(a),r(!0)},children:"编辑"},"edit"),v("a",{onClick:()=>{t(a),n(!0)},children:"改密"},"update.psw"),v(q,{placement:"left",title:"你确定要删除该用户吗?",onConfirm:()=>b(a),children:v("a",{children:"删除"})},"del")]}];return y(ee,{onSeparatorDrag:e=>i(e),assideWidth:s,assideRender:v(ce,{onDeptTreeChange:e=>{c(e)},onSelect:e=>{g({departmentIds:e.length?e:void 0})}}),children:[v(p,{actionRef:f,params:m,columns:k,size:"small",toolbar:{title:"用户管理",tooltip:"请不要随意删除用户，避免到影响其他用户的使用。"},request:async e=>{const{list:t,pagination:a}=await(r={page:e.current,limit:e.pageSize,departmentIds:e.departmentIds},G({url:L.page,method:"post",data:r}));var r;return{data:t,success:!0,total:null==a?void 0:a.total}},rowSelection:{selections:[A.SELECTION_ALL,A.SELECTION_INVERT]},tableAlertRender:({selectedRowKeys:e,onCleanSelected:t})=>y(x,{children:[y("span",{children:["已选 ",e.length," 项"]}),v("a",{onClick:t,children:"取消选择"})]}),tableAlertOptionRender:({selectedRows:e})=>v(q,{title:"你确定要删除所选角色吗?",onConfirm:()=>b(e),children:v("a",{children:"删除"})},"del"),scroll:{x:1300},search:!1,rowKey:"id",headerTitle:v(F,{type:"primary",onClick:()=>{t(void 0),r(!0)},children:"新增"})}),v(ue,{deptTree:d,detail:e,visible:a,onSuccess:()=>{r(!1),t(void 0),w()},onCancel:()=>{r(!1),t(void 0)}}),v(u,{visible:l,title:`更改管理员(${null==e?void 0:e.username})密码`,layout:"horizontal",modalProps:{onCancel:S},onFinish:async t=>{return!!(null==e?void 0:e.id)&&(await(a={userId:e.id,password:t.password},G({url:L.password,method:"post",data:a},{successMsg:"操作成功"})),I.success("更改成功！"),S(),!0);var a},children:v(o,{name:"password",label:"新密码",placeholder:"请输入新密码",rules:[{required:!0,message:"请输入新密码!"}]})},"up")]})};export{me as default};
