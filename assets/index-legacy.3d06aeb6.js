!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==t)return;var r,i,a=[],u=!0,l=!1;try{for(t=t.call(e);!(u=(r=t.next()).done)&&(a.push(r.value),!n||a.length!==n);u=!0);}catch(c){l=!0,i=c}finally{try{u||null==t.return||t.return()}finally{if(l)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function t(e,n,t,r,i,a,u){try{var l=e[a](u),c=l.value}catch(o){return void t(o)}l.done?n(c):Promise.resolve(c).then(r,i)}function r(e){return function(){var n=this,r=arguments;return new Promise((function(i,a){var u=e.apply(n,r);function l(e){t(u,i,a,l,c,"next",e)}function c(e){t(u,i,a,l,c,"throw",e)}l(void 0)}))}}System.register(["./Table-legacy.da54ef58.js","./vendor-legacy.eb2932d9.js","./index-legacy.cf65b0d7.js","./role-legacy.f5d7fd74.js","./index-legacy.d4b708dd.js","./map-legacy.e4507e83.js","./index-legacy.c78219f2.js"],(function(n){"use strict";var t,i,a,u,l,c,o,s,d,f,p,m,h,v,g,y,b,x,k,w,I,R,j,S;return{setters:[function(e){t=e.P,i=e.M,a=e.a},function(e){u=e.r,l=e.c,c=e.m,o=e.j,s=e.aE,d=e.P,f=e.aY,p=e.aI,m=e.B,h=e.ay,v=e.a$},function(e){g=e.a,y=e.e,b=e.f,x=e.P,k=e.h,w=e.b,I=e.i},function(e){R=e.P},function(e){j=e.u,S=e.g},function(){},function(){}],execute:function(){var P=function e(n,t){return n.filter((function(e){var n;return Object.is(e.parentId,null!==(n=null==t?void 0:t.key)&&void 0!==n?n:null)})).map((function(r){var i={parent:t,title:r.name,key:r.id,children:[]};return i.children=e(n,i),i}))},C=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return t.reduce((function(t,i){var a;return null!==(a=i.children)&&void 0!==a&&a.length?e(n,i.children,r):n.includes(i.key)&&t.push(i.key),t}),r)},A=function(e){var n,a=e.visible,m=e.onCancel,h=e.detail,v=e.onSuccess,w=u.exports.useRef(),I=j(r(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=5;break}return e.next=3,S();case 3:return n=e.sent,e.abrupt("return",P(n));case 5:case"end":return e.stop()}}),e)}))),[a]),A=j(r(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=5;break}return e.next=3,g();case 3:return n=e.sent,e.abrupt("return",P(n));case 5:case"end":return e.stop()}}),e)}))),[a]);return u.exports.useEffect((function(){var e=function(){var e=r(regeneratorRuntime.mark((function e(){var n,t,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=9;break}if(null==w||null===(n=w.current)||void 0===n||n.resetFields(),null==h||!h.id){e.next=9;break}return e.next=5,k({roleId:null==h?void 0:h.id});case 5:t=e.sent,r=t.menus.map((function(e){return e.menuId})),i=t.depts.map((function(e){return e.departmentId})),setTimeout((function(){var e;null==w||null===(e=w.current)||void 0===e||e.setFieldsValue({menus:C(r,I.value),depts:C(i,A.value)})}));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[h,a,I,A]),l(i,{formRef:w,title:"".concat(null!=h&&h.id?"编辑":"新增","角色"),visible:a,width:850,layout:"horizontal",modalProps:{onCancel:m},onFinish:(n=r(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==h||!h.id){e.next=10;break}return n.roleId=h.id,e.next=5,y(n);case 5:e.sent,c.success("修改成功"),e.next=15;break;case 10:return e.next=12,b(n);case 12:e.sent,c.success("创建成功");case 15:return v(),e.abrupt("return",!0);case 17:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)}),children:[l(t.Group,{children:[o(R,{width:"md",name:"name",label:"名称",placeholder:"请输入角色名称",rules:[{required:!0,message:"请输入角色名称!"}]}),o(R,{width:"md",name:"label",label:"标识",placeholder:"请输入标识",rules:[{required:!0,message:"请输入标识!"}]})]}),o(x,{name:"remark",label:"备注"}),l(s,{children:[o(p,{span:12,children:o(d.Item,{name:"menus",label:"菜单权限",valuePropName:"checkedKeys",trigger:"onCheck",children:o(f,{checkable:!0,treeData:I.value})})}),o(p,{span:12,children:o(d.Item,{name:"depts",label:"部门权限",valuePropName:"checkedKeys",trigger:"onCheck",children:o(f,{checkable:!0,treeData:A.value})})})]})]})},T=function(){var n,t=u.exports.useRef(),i=e(u.exports.useState(!1),2),c=i[0],s=i[1],d=e(u.exports.useState(void 0),2),f=d[0],p=d[1],g=function(){p(void 0),s(!1)},y=[{title:"#",width:60,dataIndex:"id"},{title:"名称",dataIndex:"name",width:200,align:"center"},{title:"标识",dataIndex:"label",width:200,align:"center"},{title:"备注",dataIndex:"remark",align:"center",width:180,ellipsis:!0},{title:"创建时间",dataIndex:"createdAt",width:180,align:"center"},{title:"更新时间",dataIndex:"updatedAt",width:180,align:"center"},{title:"操作",width:120,key:"option",valueType:"option",fixed:"right",align:"center",render:function(e,n){return[o(m,{type:"link",onClick:function(){p(n),s(!0)},children:"编辑"},"edit"),o(v,{placement:"left",title:"你确定要删除该角色吗?",onConfirm:function(){return function(e){var n;I({roleIds:[e.id]}).finally(null==t||null===(n=t.current)||void 0===n?void 0:n.reload)}(n)},children:o("a",{children:"删除"})},"del")]}}];return l(h,{children:[o(a,{actionRef:t,columns:y,rowKey:"id",scroll:{x:1300},pagination:{showQuickJumper:!0},toolbar:{title:"角色管理"},search:!1,dateFormatter:"string",headerTitle:o(m,{type:"primary",onClick:function(){p(void 0),s(!0)},children:"新增"}),request:(n=r(regeneratorRuntime.mark((function e(n){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w({limit:n.pageSize,page:n.current});case 2:return t=e.sent,e.abrupt("return",{data:t,success:!0});case 4:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}),o(A,{detail:f,visible:c,onCancel:g,onSuccess:function(){var e;g(),null==t||null===(e=t.current)||void 0===e||e.reload()}})]})};n({SystemPermissionRole:T,default:T})}}}))}();
