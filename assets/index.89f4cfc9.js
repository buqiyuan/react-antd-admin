import{P as e,M as a,a as t}from"./Table.890ed4f1.js";import{r as l,c as i,m as r,j as n,aE as d,P as s,aY as o,aI as c,B as u,ay as m,a$ as p}from"./vendor.0941f634.js";import{a as h,e as v,f,P as y,h as g,b,i as w}from"./index.e491f0c7.js";import{P as k}from"./role.f4316dde.js";import{u as x,g as I}from"./index.7ea4bc2a.js";import"./map.5b6c362c.js";import"./index.3ed70d1a.js";const j=(e,a)=>e.filter((e=>{var t;return Object.is(e.parentId,null!=(t=null==a?void 0:a.key)?t:null)})).map((t=>{const l={parent:a,title:t.name,key:t.id,children:[]};return l.children=j(e,l),l})),C=(e=[],a=[],t=[])=>a.reduce(((a,l)=>{var i;return(null==(i=l.children)?void 0:i.length)?C(e,l.children,t):e.includes(l.key)&&a.push(l.key),a}),t),P=t=>{const{visible:u,onCancel:m,detail:p,onSuccess:b}=t,w=l.exports.useRef(),P=x((async()=>{if(u){const e=await I();return j(e)}}),[u]),S=x((async()=>{if(u){const e=await h();return j(e)}}),[u]);return l.exports.useEffect((()=>{(async()=>{var e;if(u&&(null==(e=null==w?void 0:w.current)||e.resetFields(),null==p?void 0:p.id)){const e=await g({roleId:null==p?void 0:p.id}),a=e.menus.map((e=>e.menuId)),t=e.depts.map((e=>e.departmentId));setTimeout((()=>{var e;null==(e=null==w?void 0:w.current)||e.setFieldsValue({menus:C(a,P.value),depts:C(t,S.value)})}))}})()}),[p,u,P,S]),i(a,{formRef:w,title:((null==p?void 0:p.id)?"编辑":"新增")+"角色",visible:u,width:850,layout:"horizontal",modalProps:{onCancel:m},onFinish:async e=>{if(null==p?void 0:p.id){e.roleId=p.id;await v(e);r.success("修改成功")}else{await f(e);r.success("创建成功")}return b(),!0},children:[i(e.Group,{children:[n(k,{width:"md",name:"name",label:"名称",placeholder:"请输入角色名称",rules:[{required:!0,message:"请输入角色名称!"}]}),n(k,{width:"md",name:"label",label:"标识",placeholder:"请输入标识",rules:[{required:!0,message:"请输入标识!"}]})]}),n(y,{name:"remark",label:"备注"}),i(d,{children:[n(c,{span:12,children:n(s.Item,{name:"menus",label:"菜单权限",valuePropName:"checkedKeys",trigger:"onCheck",children:n(o,{checkable:!0,treeData:P.value})})}),n(c,{span:12,children:n(s.Item,{name:"depts",label:"部门权限",valuePropName:"checkedKeys",trigger:"onCheck",children:n(o,{checkable:!0,treeData:S.value})})})]})]})},S=()=>{const e=l.exports.useRef(),[a,r]=l.exports.useState(!1),[d,s]=l.exports.useState(void 0),o=()=>{s(void 0),r(!1)},c=[{title:"#",width:60,dataIndex:"id"},{title:"名称",dataIndex:"name",width:200,align:"center"},{title:"标识",dataIndex:"label",width:200,align:"center"},{title:"备注",dataIndex:"remark",align:"center",width:180,ellipsis:!0},{title:"创建时间",dataIndex:"createdAt",width:180,align:"center"},{title:"更新时间",dataIndex:"updatedAt",width:180,align:"center"},{title:"操作",width:120,key:"option",valueType:"option",fixed:"right",align:"center",render:(a,t)=>[n(u,{type:"link",onClick:()=>{s(t),r(!0)},children:"编辑"},"edit"),n(p,{placement:"left",title:"你确定要删除该角色吗?",onConfirm:()=>(a=>{var t;w({roleIds:[a.id]}).finally(null==(t=null==e?void 0:e.current)?void 0:t.reload)})(t),children:n("a",{children:"删除"})},"del")]}];return i(m,{children:[n(t,{actionRef:e,columns:c,rowKey:"id",scroll:{x:1300},pagination:{showQuickJumper:!0},toolbar:{title:"角色管理"},search:!1,dateFormatter:"string",headerTitle:n(u,{type:"primary",onClick:()=>{s(void 0),r(!0)},children:"新增"}),request:async e=>({data:await b({limit:e.pageSize,page:e.current}),success:!0})}),n(P,{detail:d,visible:a,onCancel:o,onSuccess:()=>{var a;o(),null==(a=null==e?void 0:e.current)||a.reload()}})]})};export{S as SystemPermissionRole,S as default};
